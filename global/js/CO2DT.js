 // main function that defines the input variables and known data
 // swap out different Fa_xxxx variables to see different CO2 and dT forecast results
 
        // years that has existing data
       var year = [1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970, +
                             1971,1972,1973,1974,1975,1976,1977,1978,1979,1980, + 
                             1981,1982,1983,1984,1985,1986,1987,1988,1989,1990, + 
                             1991,1992,1993,1994,1995,1996,1997,1998,1999,2000, +
                             2001,2002,2003,2004,2005,2006,2007,2008,2009,2010, +
                             2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021];
         //CO2 concentration in ppm, current data to year 2021                    
       var C_CO2 = [315.98,316.91,317.64,318.45,318.99,319.62,320.04,321.37,322.18,323.05,324.62,325.68, +
                                  326.32,327.46,329.68,330.19,331.13,332.03,333.84,335.41,336.84,338.76, +
                                  340.12,341.48,343.15,344.87,346.35,347.61,349.31,351.69,353.20,354.45, +
                                  355.70,356.54,357.21,358.96,360.97,362.74,363.88,366.84,368.54,369.71, +
                                  371.32,373.45,375.98,377.70,379.98,382.09,384.02,385.83,387.64,390.10, +
                                  391.85,394.06,396.74,398.81,401.01,404.41,406.76,408.72,411.66,414.24,416.45];
  
        //Temperature change, current data to year 2021
       var   dT = [0.03,-0.03,0.06,0.03,0.05,-0.20,-0.11,-0.06,-0.02,-0.08,0.05,0.03, +
                             -0.08,0.01,0.16,-0.07,-0.01,-0.10,0.18,0.07,0.16,0.26, +
                             0.32,0.14,0.31,0.16,0.12,0.18,0.32,0.39,0.27,0.45, +
                             0.40,0.22,0.23,0.32,0.45,0.33,0.46,0.61,0.38,0.39, +
                             0.53,0.63,0.62,0.53,0.67,0.63,0.66,0.54,0.65,0.72, +
                             0.61,0.65,0.67,0.74,0.89,1.01,0.92,0.84,0.97,1.02,0.84];

        // Cabon emission term in Eq 17a, contains historical values (to 2021), and projects (2022-2100), best scenario
       var Fa_B1T_MESSAGE = [8.86,9.39,9.42,9.75,10.27,10.83,11.32,11.87,12.24,12.91,13.77,14.90, +
            15.50,16.22,17.08,17.01,17.05,17.98,18.49,19.07,19.61,19.49, +
            19.03,18.88,19.00,19.66,20.32,20.62,21.27,22.10,22.41,22.75, +
            23.24,22.57,22.80,22.96,23.45,24.15,24.30,24.21,24.52,25.23, +
            25.45,26.04,27.37,28.63,29.60,30.58,31.49,32.07,31.61,33.34, +
            34.47,34.97,35.28,35.53,35.50,35.45,35.93,36.65,36.70,34.81, +
            36.40,36.07,35.74,35.40,35.07,34.74,34.41,34.08,33.75,33.41, +
            33.35,33.29,33.23,33.17,33.11,33.05,32.99,32.93,32.87,32.80, +
            32.39,31.97,31.55,31.13,30.71,30.30,29.88,29.46,29.04,28.62, +
            28.19,27.76,27.33,26.90,26.47,26.04,25.61,25.18,24.75,24.32, +
            23.85,23.38,22.91,22.43,21.96,21.49,21.02,20.55,20.08,19.60, +
            19.24,18.87,18.51,18.14,17.78,17.41,17.04,16.68,16.31,15.95, +
            15.58,15.21,14.85,14.48,14.11,13.75,13.38,13.01,12.65,12.28, +
            12.04,11.79,11.54,11.30,11.05,10.81,10.56,10.32,10.07,9.82];

       // Cabon emission term in Eq 17a, contains historical values (to 2021), and projects (2022-2100), worst scenario
       var Fa_A1G_MINICAM = [8.86,9.39,9.42,9.75,10.27,10.83,11.32,11.87,12.24,12.91,13.77,14.90, +
            15.50,16.22,17.08,17.01,17.05,17.98,18.49,19.07,19.61,19.49, +
            19.03,18.88,19.00,19.66,20.32,20.62,21.27,22.10,22.41,22.75, +
            23.24,22.57,22.80,22.96,23.45,24.15,24.30,24.21,24.52,25.23, +
            25.45,26.04,27.37,28.63,29.60,30.58,31.49,32.07,31.61,33.34, +
            34.47,34.97,35.28,35.53,35.50,35.45,35.93,36.65,36.70,34.81, +
            36.40,38.95,41.50,44.05,46.61,49.16,51.71,54.26,56.81,59.36, +
            60.75,62.14,63.52,64.91,66.29,67.68,69.07,70.45,71.84,73.22, +
            74.66,76.11,77.55,78.99,80.43,81.87,83.31,84.75,86.19,87.63, +
            88.29,88.95,89.60,90.26,90.92,91.57,92.23,92.88,93.54,94.20, +
            94.78,95.36,95.95,96.53,97.11,97.69,98.28,98.86,99.44,100.03, + 
            100.54,101.05,101.57,102.08,102.59,103.11,103.62,104.13,104.65,105.16, +
            105.06,104.97,104.87,104.78,104.68,104.59,104.49,104.40,104.30,104.21, +
            104.14,104.07,104.01,103.94,103.88,103.81,103.74,103.68,103.61,103.55 ];
        // Cabon emission term in Eq 17a, contains historical values (to 2021), and projects (2022-2100), 2nd worst scenario
        var Fa_A2_ASF = [8.86,9.39,9.42,9.75,10.27,10.83,11.32,11.87,12.24,12.91,13.77,14.90, +
                15.50,16.22,17.08,17.01,17.05,17.98,18.49,19.07,19.61,19.49, +
                19.03,18.88,19.00,19.66,20.32,20.62,21.27,22.10,22.41,22.75, +
                23.24,22.57,22.80,22.96,23.45,24.15,24.30,24.21,24.52,25.23, +
                25.45,26.04,27.37,28.63,29.60,30.58,31.49,32.07,31.61,33.34, +
                34.47,34.97,35.28,35.53,35.50,35.45,35.93,36.65,36.70,34.81, +
                36.40,38.35,40.31,42.26,44.22,46.17,48.12,50.08,52.03,53.99, +
                54.48,54.98,55.47,55.97,56.46,56.96,57.45,57.95,58.44,58.94, +
                59.43,59.93,60.43,60.92,61.42,61.91,62.41,62.90,63.40,63.89, +
                64.53,65.16,65.80,66.43,67.06,67.70,68.33,68.97,69.60,70.24, +
                70.87,71.50,72.14,72.77,73.41,74.04,74.68,75.31,75.95,76.58, +
                77.43,78.29,79.14,80.00,80.86,81.71,82.57,83.42,84.28,85.13, +
                86.21,87.28,88.36,89.43,90.51,91.59,92.66,93.74,94.81,95.89, +
                96.97,98.04,99.12,100.19,101.27,102.35,103.42,104.50,105.57,106.65 ];

       // Cabon emission term in Eq 17a, contains historical values (to 2021), and projects (2022-2100), middle scenario
       var Fa_B2C_Maria = [8.86,9.39,9.42,9.75,10.27,10.83,11.32,11.87,12.24,12.91,13.77,14.90, +
                15.50,16.22,17.08,17.01,17.05,17.98,18.49,19.07,19.61,19.49, +
                19.03,18.88,19.00,19.66,20.32,20.62,21.27,22.10,22.41,22.75, +
                23.24,22.57,22.80,22.96,23.45,24.15,24.30,24.21,24.52,25.23, +
                25.45,26.04,27.37,28.63,29.60,30.58,31.49,32.07,31.61,33.34, +
                34.47,34.97,35.28,35.53,35.50,35.45,35.93,36.65,36.70,34.81, +
                36.40,37.59,38.78,39.97,41.16,42.35,43.54,44.73,45.92,47.11, +
                47.81,48.51,49.21,49.91,50.61,51.31,52.01,52.71,53.41,54.11, +
                54.38,54.66,54.94,55.22,55.49,55.77,56.05,56.33,56.60,56.88, +
                57.36,57.84,58.31,58.79,59.27,59.74,60.22,60.70,61.17,61.65, +
                61.99,62.33,62.67,63.01,63.34,63.68,64.02,64.36,64.70,65.04, +
                65.34,65.65,65.96,66.27,66.57,66.88,67.19,67.49,67.80,68.11, +
                68.32,68.54,68.75,68.97,69.18,69.40,69.62,69.83,70.05,70.26, +
                70.46,70.67,70.87,71.07,71.27,71.47,71.68,71.88,72.08,72.28 ];       
       // Cabon emission term in Eq 17a, contains historical values (to 2021), and projects (2022-2100), 2nd best scenario
       var Fa_B1_IMAGE = [8.86,9.39,9.42,9.75,10.27,10.83,11.32,11.87,12.24,12.91,13.77,14.90, +
                15.50,16.22,17.08,17.01,17.05,17.98,18.49,19.07,19.61,19.49, +
                19.03,18.88,19.00,19.66,20.32,20.62,21.27,22.10,22.41,22.75, +
                23.24,22.57,22.80,22.96,23.45,24.15,24.30,24.21,24.52,25.23, +
                25.45,26.04,27.37,28.63,29.60,30.58,31.49,32.07,31.61,33.34, +
                34.47,34.97,35.28,35.53,35.50,35.45,35.93,36.65,36.70,34.81, +
                36.40,36.88,37.36,37.84,38.32,38.80,39.28,39.76,40.24,40.72, +
                40.95,41.17,41.39,41.62,41.84,42.07,42.29,42.51,42.74,42.96, +
                42.80,42.65,42.49,42.33,42.17,42.02,41.86,41.70,41.54,41.39, + 
                40.82,40.25,39.68,39.12,38.55,37.98,37.41,36.85,36.28,35.71, +
                35.14,34.56,33.99,33.42,32.84,32.27,31.70,31.12,30.55,29.98, +
                29.43,28.89,28.35,27.81,27.27,26.73,26.18,25.64,25.10,24.56, +
                24.06,23.55,23.05,22.54,22.04,21.53,21.03,20.52,20.02,19.51, +
                19.11,18.71,18.31,17.91,17.51,17.11,16.71,16.31,15.91,15.51 ];    

		// Custom base, Business As Usual, use linear simulation to project the carbon emission trend
		var Fa_BAU_lin = [8.86,9.39,9.42,9.75,10.27,10.83,11.32,11.87,12.24,12.91,13.77,14.90, +
				15.51,16.23,17.09,17.02,17.05,17.99,18.50,19.08,19.62,19.50, + 
				19.04,18.88,19.01,19.66,20.33,20.63,21.27,22.11,22.41,22.76, +
				23.24,22.58,22.81,22.97,23.46,24.16,24.30,24.21,24.73,25.45, +
				25.67,26.28,27.65,28.64,29.61,30.59,31.51,32.09,31.56,33.36, +
				34.49,35.01,35.32,35.58,35.56,35.52,36.10,36.83,37.08,35.26, +
				37.12,37.58,38.03,38.49,38.94,39.40,39.85,40.30,40.76,41.21, +
				41.67,42.12,42.58,43.03,43.48,43.94,44.39,44.85,45.30,45.75, +
				46.21,46.66,47.12,47.57,48.02,48.48,48.93,49.39,49.84,50.30, +
				50.75,51.20,51.66,52.11,52.57,53.02,53.47,53.93,54.38,54.83, +
				55.29,55.74,56.20,56.65,57.11,57.56,58.01,58.47,58.92,59.38, +
				59.83,60.29,60.74,61.19,61.65,62.10,62.56,63.01,63.46,63.92, +
				64.37,64.83,65.28,65.73,66.19,66.64,67.10,67.55,68.00,68.46, +
				68.91,69.37,69.82,70.28,70.73,71.18,71.64,72.09,72.55,73];
		
		// Custom base, Business As Usual, use poly simulation to project the carbon emission trend
		var Fa_BAU_poly = [8.86,9.39,9.42,9.75,10.27,10.83,11.32,11.87,12.24,12.91,13.77,14.90, +
				15.51,16.23,17.09,17.02,17.05,17.99,18.50,19.08,19.62,19.50, + 
				19.04,18.88,19.01,19.66,20.33,20.63,21.27,22.11,22.41,22.76, +
				23.24,22.58,22.81,22.97,23.46,24.16,24.30,24.21,24.73,25.45, +
				25.67,26.28,27.65,28.64,29.61,30.59,31.51,32.09,31.56,33.36, +
				34.49,35.01,35.32,35.58,35.56,35.52,36.10,36.83,37.08,35.26, +
				37.12,38.75,39.31,39.87,40.43,41.00,41.57,42.14,42.71,43.29, +
				43.87,44.46,45.05,45.64,46.23,46.83,47.43,48.03,48.64,49.24, +
				49.86,50.47,51.09,51.71,52.33,52.96,53.59,54.22,54.86,55.50, +
				56.14,56.78,57.43,58.08,58.73,59.39,60.05,60.71,61.38,62.05, +
				62.72,63.39,64.07,64.75,65.43,66.12,66.81,67.50,68.20,68.90, +
				69.60,70.30,71.01,71.72,72.44,73.15,73.87,74.59,75.32,76.05, +
				76.78,77.51,78.25,78.99,79.74,80.48,81.23,81.99,82.74,83.50, +
				84.26,85.03,85.79,86.56,87.34,88.11,88.89,89.68,90.46,91.25];
				

		// Custom base, Business As Usual, use exponential simulation to project the carbon emission trend
		var Fa_BAU_exp = [8.86,9.39,9.42,9.75,10.27,10.83,11.32,11.87,12.24,12.91,13.77,14.90, +
				15.51,16.23,17.09,17.02,17.05,17.99,18.50,19.08,19.62,19.50, + 
				19.04,18.88,19.01,19.66,20.33,20.63,21.27,22.11,22.41,22.76, +
				23.24,22.58,22.81,22.97,23.46,24.16,24.30,24.21,24.73,25.45, +
				25.67,26.28,27.65,28.64,29.61,30.59,31.51,32.09,31.56,33.36, +
				34.49,35.01,35.32,35.58,35.56,35.52,36.10,36.83,37.08,35.26, +
				37.12,48.63,49.96,51.32,52.73,54.17,55.65,57.18,58.74,60.35, +
				62.00,63.70,65.44,67.23,69.07,70.96,72.90,74.90,76.95,79.05, +
				81.22,83.44,85.72,88.07,90.48,92.96,95.50,98.11,100.80,103.56, +
				106.39,109.30,112.30,115.37,118.53,121.77,125.10,128.53,132.04, +
				135.66,139.37,143.19,147.10,151.13,155.27,159.51,163.88,168.37, +
				172.97,177.71,182.57,187.57,192.70,197.97,203.39,208.96,214.68, +
				220.55,226.59,232.79,239.16,245.71,252.43,259.34,266.44,273.73, +
				281.22,288.92,296.82,304.95,313.29,321.87,330.68,339.73,349.02, +
				358.57,368.39,378.47,388.83,399.47];

		const FA_MAP = {
						"A1G_MINICAM": Fa_A1G_MINICAM,
						"A2_ASF":      Fa_A2_ASF, 
						"B2C_Maria":   Fa_B2C_Maria,
						"B1_IMAGE":    Fa_B1_IMAGE,
						"B1T_MESSAGE": Fa_B1T_MESSAGE,
						"BAU_LIN":     Fa_BAU_lin,
						"BAU_POLY":    Fa_BAU_poly,
						"BAU_EXP":     Fa_BAU_exp,
		                };
		
		// difference between 1959-1980 mean and pre-industrial (1950-1800) mean
		const TADJUST = 0.09;

        // O2DTPred(year,Fa_A1G_MINICAM,C_CO2,dT): CO2 and dT prediction function: variable year, Fa_xxx, C_CO2, dT are loaded with given data
        // year, C_CO2, dT are loaded with known data, Fa_xxxx is loaded with known data and predictions of future emissions
        // the function returns expanded year, C_CO2, dT, until the target year, which is determined by the length of Fa_xxx array

//            if (CO2DTPred(year,Fa_B1_IMAGE,C_CO2,dT) == 1 ){ 
//                for (let i = 0; i< year.length; i++ )  console.log(year[i], C_CO2[i], dT[i]); 
//            }

/* For the scope of this project, 
   - the future years starts at 2022 and ends at 2100 
   - parameter fa_name is the name of the seeded scenario
   - return results are in the format of [ {"year" : 2022, "gmt": ....} {...} {...} ... ] 
*/
function CO2DTFuture(fa_name) {
	var futureData = [];

	var fa = FA_MAP[fa_name];

	// ks = 0.1196, Va=2.24, beta_T = 3.5, alpha = 3.7761, C0 = 324.54
    const Va = 2.13, Css = 280, Css_PgC = Css*Va,  ks = 0.04, beta_T = 3.5, alpha = 2.75, C0 = 280;
 
    //CO2 in PgC
	let C = []; 
    let C_PgC = [];             
    for (let i = 0; i<= C_CO2.length; i++) {
		    C[i] = C_CO2[i];
            C_PgC[i] = C_CO2[i] * Va;
          }
    for (let i = 2022; i <= 2100 ; i ++ ) {
		let dt = alpha*Math.log(C[i-1959-1]/C0);
		// Eq. 17a dCdt = Fa + beta_T*dT - ks * (C-Css), using simpler explicit method here C = C of previous year's value             
		let dCdt = fa[i-1959] + beta_T*dt -ks*(C_PgC[i-1959-1]-Css_PgC);
		C_PgC[i-1959] = (C_PgC[i-1959-1] + dCdt * 1.0); // 1.0 is the time/year interval, symbolically put in here, just to make it clear
		C[i-1959] = C_PgC[i-1959]/Va;

		console.log("Year=" + i + ", FA=" + fa[i-1959] + ", c_PgC=" + C_PgC[i-1959] + ", dt=" + (dt+TADJUST).toFixed(2));

		futureData.push({"year": i+"", "gmt" : (dt+TADJUST).toFixed(2)});
    }
	
	return futureData;
}

/**
  For the custom case that user select a fossil fuel year over year replacement rate (Fossile fuel replaced by renewable energy)
  - Baseline (percentage) of year 2021:
    Coal: 0.401872
	Oil:  0.317357
	Gas:  0.225967
	Cement: 0.046512
	Other:  0.008403
  - Percentage of Cement and Other do not change
*/
function CO2DTCustom(fa_name, rRate) {
	var futureData = [];

	console.log("============ FA NAME: " + fa_name + " ===============");

    // linear simulation: y=0.4541*x - 880.61, R2=0.9791
	var fa = FA_MAP[fa_name];

    let p_fossil_o = 0.401872 + 0.317357 + 0.225967;
	let p_fossil = p_fossil_o;
	let p_other = 0.046512 + 0.008403;
	
    const Va = 2.13, Css = 280, Css_PgC = Css*Va,  ks = 0.04, beta_T = 3.5, alpha = 2.75, C0 = 280;
 
    //CO2 in PgC
	let C = []; 
    let C_PgC = [];             
    for (let i = 0; i<= C_CO2.length; i++) {
		    C[i] = C_CO2[i];
            C_PgC[i] = C_CO2[i] * Va;
          }
    for (let i = 2022; i <= 2100 ; i ++ ) {
		let dt = alpha*Math.log(C[i-1959-1]/C0);

		// new fossile rate
		p_fossil = p_fossil * (1-rRate);
		
		// the actual fa after consider the fossile fuel replace rate
		let ff = fa[i-1959] * (p_fossil_o/15 + p_fossil*14/15 + p_other);
		
		//console.log("Year=" + i + ", FA=" + ff);
		
		// Eq. 17a dCdt = Fa + beta_T*dT - ks * (C-Css), using simpler explicit method here C = C of previous year's value    
		let dCdt = ff + beta_T*dt -ks*(C_PgC[i-1959-1]-Css_PgC);
		C_PgC[i-1959] = (C_PgC[i-1959-1] + dCdt * 1.0); // 1.0 is the time/year interval, symbolically put in here, just to make it clear


		C[i-1959] = C_PgC[i-1959]/Va;

		console.log("Year=" + i + ", FA=" + ff + ", c_PgC=" + C_PgC[i-1959] + ", dt=" + (dt+TADJUST).toFixed(2));

		futureData.push({"year": i+"", "gmt" : (dt+TADJUST).toFixed(2)});
    }
	
	return futureData;
}

function CO2DTPred(Y, F, C, T) {
        // This function use the math model Eq 17a to predict CO2 level and temperature change
        // Parameters: Y : year ; F; Fa, carbon emission in PgC for each year ; 
        //             C: CO2 concentration in ppm; T: temperature change, degC
        // Css_PgC: 280ppm CO2 equivalent in PgC unit = 280 * Va (Va is the conversion factor from ppm to PgC)
        // alpha, C0: model constant for temperature prediction (equation 16a)
        // beta_T: temperature term coefficient in Eq. 17a
        // ks: sink term coefficient in Eq. 17a 

    // the Va value: our paper used 2.35, spreadsheet used 2.24, online ref seems to suggest 2.12
    // results are not much different using either of these values

    const Va = 2.24, Css = 280, Css_PgC = Css*Va,  ks = 0.1196, beta_T = 3.5, alpha = 3.7761, C0 = 324.54 ;
 
    // endY: target year to calculate to, assuming F variable is given to the target year
    let endY = F.length + Y[0] -1;
    
    if (endY <= Y[Y.length-1]) {
        console.log('Target year needs to be later than', Y[Y.length-1]);
        return (0);
    }
    //CO2 in PgC
    let C_PgC = [];             
    for (let i = 0; i<= C.length; i++) {
            C_PgC[i] = C[i] * Va;
          }
    for (let i = Y.length; i <= endY - Y[0] ; i ++ ) {
              // increase year
              Y.push(i + 1959);
              // calculate dT for year i, using previous year's C
              T[i] = alpha*Math.log(C[i-1]/C0);
              // Eq. 17a dCdt = Fa + beta_T*dT - ks * (C-Css), using simpler explicit method here C = C of previous year's value             
              let dCdt = F[i] + beta_T*dT[i] -ks*(C_PgC[i-1]-Css_PgC);
              C_PgC[i] = (C_PgC[i-1] + dCdt * 1.0); // 1.0 is the time/year interval, symbolically put in here, just to make it clear
              C[i] = C_PgC[i]/Va;

              // debug output: console.log(Y[i], C[i], T[i]);
       }
    return(1);
    }